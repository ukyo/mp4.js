/* mp4.js - Licensed under the Apache License 2 https://github.com/ukyo/mp4.js/blob/master/LICENSE */var Mp4;(function(t){var e=Object.prototype.toString,r=new Uint8Array(32768),i=new Uint16Array(r.buffer),n=new Uint32Array(r.buffer),s=function(t){for(var e=r.byteLength+t,s=r.byteLength;e>s;)s*=2;var a=new Uint8Array(s);a.set(r),r=a,i=new Uint16Array(a.buffer),n=new Uint32Array(a.buffer)},a=function(){function t(t,r,i){if("number"==typeof t)this.view=new DataView(new ArrayBuffer(t));else switch(e.call(t)){case"[object ArrayBuffer]":r=r||0,i=i||t.byteLength,this.view=new DataView(t,r,i);break;case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object CanvasPixelArray]":case"[object Int8Array]":case"[object Uint16Array]":case"[object Int16Array]":case"[object Uint32Array]":case"[object Int32Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object DataView]":this.view=void 0===r&&void 0===i?new DataView(t.buffer,t.byteOffset,t.byteLength):void 0!==r&&void 0===i?new DataView(t.buffer,t.byteOffset+r):void 0===r&&void 0!==i?new DataView(t.buffer,t.byteOffset,i):new DataView(t.buffer,r,i);break;default:throw new TypeError}this.buffer=this.view.buffer,this.byteOffset=this.view.byteOffset,this.byteLength=this.view.byteLength}return t.prototype.getUint8=function(t){return this.view.getUint8(t)},t.prototype.setUint8=function(t,e){this.view.setUint8(t,e)},t.prototype.getInt8=function(t){return this.view.getInt8(t)},t.prototype.setInt8=function(t,e){this.view.setInt8(t,e)},t.prototype.getUint16=function(t,e){return e===void 0&&(e=!1),this.view.getUint16(t,e)},t.prototype.setUint16=function(t,e,r){r===void 0&&(r=!1),this.view.setUint16(t,e,r)},t.prototype.getInt16=function(t,e){return e===void 0&&(e=!1),this.view.getInt16(t,e)},t.prototype.setInt16=function(t,e,r){r===void 0&&(r=!1),this.view.setInt16(t,e,r)},t.prototype.getUint32=function(t,e){return e===void 0&&(e=!1),this.view.getUint32(t,e)},t.prototype.setUint32=function(t,e,r){r===void 0&&(r=!1),this.view.setUint32(t,e,r)},t.prototype.getInt32=function(t,e){return e===void 0&&(e=!1),this.view.getInt32(t,e)},t.prototype.setInt32=function(t,e,r){r===void 0&&(r=!1),this.view.setInt32(t,e,r)},t.prototype.getFloat32=function(t,e){return e===void 0&&(e=!1),this.view.getFloat32(t,e)},t.prototype.setFloat32=function(t,e,r){r===void 0&&(r=!1),this.view.setFloat32(t,e,r)},t.prototype.getFloat64=function(t,e){return e===void 0&&(e=!1),this.view.getFloat64(t,e)},t.prototype.setFloat64=function(t,e,r){r===void 0&&(r=!1),this.view.setFloat64(t,e,r)},t.prototype.getString=function(t,e){var r=new Uint8Array(this.buffer,this.byteOffset+t,e);return String.fromCharCode.apply(null,r)},t.prototype.setString=function(t,e){for(var r=new Uint8Array(this.buffer,this.byteOffset+t),i=e.length;i;)r[--i]=e.charCodeAt(i)},t.prototype.getUTF8String=function(e){var r=new Uint8Array(this.buffer,this.byteOffset+e,this.byteLength);return t.UTF8BytesToString(r)},t.stringToUTF8Bytes=function(t){var e,i,n=t.length,a=-1,o=r,p=o.byteLength;for(e=0;n>e;++e)i=t.charCodeAt(e),127>=i?o[++a]=i:2047>=i?(o[++a]=192|i>>>6,o[++a]=128|63&i):65535>=i?(o[++a]=224|i>>>12,o[++a]=128|63&i>>>6,o[++a]=128|63&i):(o[++a]=240|i>>>18,o[++a]=128|63&i>>>12,o[++a]=128|63&i>>>6,o[++a]=128|63&i),4>=p-a&&(s(4),o=r);var u=new Uint8Array(++a);return u.set(o.subarray(0,a)),u},t.UTF8BytesToString=function(t){for(var e,r=t.byteLength,i=n,s=0,a=0,o="";r>a;){for(s=0;4096>s&&r>a;++a,++s)e=t[a],128>e?i[s]=e:6===e>>>5?(i[s]=(31&e)<<6,i[s]|=63&t[++a]):14===e>>>4?(i[s]=(15&e)<<12,i[s]|=(63&t[++a])<<6,i[s]|=63&t[++a]):(i[s]=(7&e)<<18,i[s]|=(63&t[++a])<<12,i[s]|=(63&t[++a])<<6,i[s]|=63&t[++a]);o+=String.fromCharCode.apply(null,i.subarray(0,s))}return o},t.prototype.setUTF8String=function(e,r){var i=t.stringToUTF8Bytes(r),n=new Uint8Array(this.buffer,this.byteOffset,this.byteLength);return n.set(i,e),i.length},t.prototype.getUint24=function(t,e){e===void 0&&(e=!1);var r=new Uint8Array(this.buffer,this.byteOffset+t);return e?r[0]|r[1]<<8|r[2]<<16:r[2]|r[1]<<8|r[0]<<16},t.prototype.setUint24=function(t,e,r){r===void 0&&(r=!1);var i=new Uint8Array(this.buffer,this.byteOffset+t);r?(i[0]=255&e,i[1]=(65280&e)>>8,i[2]=(16711680&e)>>16):(i[2]=255&e,i[1]=(65280&e)>>8,i[0]=(16711680&e)>>16)},t.prototype.getInt24=function(t,e){e===void 0&&(e=!1);var r=this.getUint24(t,e);return 8388608&r?r-16777216:r},t.prototype.setInt24=function(t,e,r){r===void 0&&(r=!1),this.setUint24(t,e,r)},t}();t.DataView2=a})(Mp4||(Mp4={}));var Mp4;(function(t){var e=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431],r=Math.pow(2,25),i=function(){function i(e){this.bytes=e,this.bitOffset=0,this.view=new t.DataView2(e)}return i.prototype.readBits=function(t){if(0>=t)throw Error();for(var i,n,s,a=25,o=0;t>0;){switch(s=t>a?a:t,o*=r,n=Math.ceil((this.bitOffset%8+s)/8)){case 1:i=this.view.getUint8(this.byteOffset);break;case 2:i=this.view.getUint16(this.byteOffset);break;case 3:i=this.view.getUint24(this.byteOffset);break;case 4:i=this.view.getUint32(this.byteOffset)}o+=i>>>8*n-(this.bitOffset%8+s)&e[s],this.skipBits(s),t-=s}return o},i.prototype.readUint8=function(){var t=this.view.getUint8(this.byteOffset);return this.skipBytes(1),t},i.prototype.readInt8=function(){var t=this.view.getInt8(this.byteOffset);return this.skipBytes(1),t},i.prototype.readUint16=function(){var t=this.view.getUint16(this.byteOffset);return this.skipBytes(2),t},i.prototype.readInt16=function(){var t=this.view.getInt16(this.byteOffset);return this.skipBytes(2),t},i.prototype.readUint24=function(){var t=this.view.getUint24(this.byteOffset);return this.skipBytes(3),t},i.prototype.readInt24=function(){var t=this.view.getInt24(this.byteOffset);return this.skipBytes(3),t},i.prototype.readUint32=function(){var t=this.view.getUint32(this.byteOffset);return this.skipBytes(4),t},i.prototype.readInt32=function(){var t=this.view.getInt32(this.byteOffset);return this.skipBytes(4),t},i.prototype.readFloat32=function(){var t=this.view.getFloat32(this.byteOffset);return this.skipBytes(4),t},i.prototype.readFloat64=function(){var t=this.view.getFloat64(this.byteOffset);return this.skipBytes(8),t},i.prototype.readBytes=function(t){var e=this.byteOffset,r=this.bytes.subarray(e,e+t);return this.skipBytes(t),r},i.prototype.readString=function(t){t===void 0&&(t=0);var e;if(0===t){var r=this.bytes.subarray(this.byteOffset);e=String.fromCharCode.apply(null,r),t=r.length}else e=this.view.getString(this.byteOffset,t);return this.skipBytes(t),e},i.prototype.readStringNullTerminated=function(){var t=this.bytes.subarray(this.byteOffset),e=0;if(!t.byteLength)return"";for(;0!==t[e++];);return this.skipBytes(e),String.fromCharCode.apply(null,t.subarray(0,e-1))},i.prototype.readUTF8StringNullTerminated=function(){var e=this.bytes.subarray(this.byteOffset),r=0;if(!e.byteLength)return"";for(;0!==e[r++];);return this.skipBytes(r),t.DataView2.UTF8BytesToString(e.subarray(0,r-1))},i.prototype.skipBits=function(t){this.bitOffset+=t},i.prototype.skipBytes=function(t){this.bitOffset+=8*t},Object.defineProperty(i.prototype,"byteOffset",{get:function(){return this.bitOffset>>>3},enumerable:!0,configurable:!0}),i.prototype.eof=function(){return this.bitOffset/8>=this.bytes.length},i}();t.BitReader=i})(Mp4||(Mp4={}));var Mp4;(function(t){var e=function(){function e(){this.bitOffset=0,this.bytes=new Uint8Array(2),this.view=new t.DataView2(this.bytes)}return Object.defineProperty(e.prototype,"data",{get:function(){var t=this.byteOffset;if(t>this.bytes.length){var e=new Uint8Array(t);return e.set(this.bytes),e}return this.bytes.subarray(0,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteOffset",{get:function(){return this.bitOffset>>>3},enumerable:!0,configurable:!0}),e.prototype.skipBits=function(t){this.bitOffset+=t},e.prototype.skipBytes=function(t){this.skipBits(8*t)},e.prototype.writeBits=function(t,e){this.expandBuffer(e);var r,i=Math.ceil((this.bitOffset%8+e)/8);switch(i){case 1:r=this.view.getUint8(this.byteOffset);break;case 2:r=this.view.getUint16(this.byteOffset);break;case 3:r=this.view.getUint24(this.byteOffset);break;case 4:r=this.view.getUint32(this.byteOffset)}switch(r|=t<<8*i-(this.bitOffset%8+e),i){case 1:this.view.setUint8(this.byteOffset,r);break;case 2:this.view.setUint16(this.byteOffset,r);break;case 3:this.view.setUint24(this.byteOffset,r);break;case 4:this.view.setUint32(this.byteOffset,r)}this.skipBits(e)},e.prototype.writeBytes=function(t){this.expandBuffer(8*t.length),this.bytes.set(t,this.byteOffset),this.skipBytes(t.length)},e.prototype.writeUint8=function(t){this.expandBuffer(8),this.view.setUint8(this.byteOffset,t),this.skipBytes(1)},e.prototype.writeInt8=function(t){this.expandBuffer(8),this.view.setInt8(this.byteOffset,t),this.skipBytes(1)},e.prototype.writeUint16=function(t){this.expandBuffer(16),this.view.setUint16(this.byteOffset,t),this.skipBytes(2)},e.prototype.writeInt16=function(t){this.expandBuffer(16),this.view.setInt16(this.byteOffset,t),this.skipBytes(2)},e.prototype.writeUint24=function(t){this.expandBuffer(24),this.view.setUint24(this.byteOffset,t),this.skipBytes(3)},e.prototype.writeInt24=function(t){this.expandBuffer(24),this.view.setInt24(this.byteOffset,t),this.skipBytes(3)},e.prototype.writeUint32=function(t){this.expandBuffer(32),this.view.setUint32(this.byteOffset,t),this.skipBytes(4)},e.prototype.writeInt32=function(t){this.expandBuffer(32),this.view.setInt32(this.byteOffset,t),this.skipBytes(4)},e.prototype.writeFloat32=function(t){this.expandBuffer(32),this.view.setFloat32(this.byteOffset,t),this.skipBytes(4)},e.prototype.writeFloat64=function(t){this.expandBuffer(64),this.view.setFloat64(this.byteOffset,t),this.skipBytes(8)},e.prototype.writeString=function(t){this.expandBuffer(8*t.length),this.view.setString(this.byteOffset,t),this.skipBytes(t.length)},e.prototype.writeStringNullTerminated=function(t){this.writeString(t+"\0")},e.prototype.writeUTF8String=function(e){var r=t.DataView2.stringToUTF8Bytes(e);this.expandBuffer(8*r.length),this.writeBytes(r)},e.prototype.writeUTF8StringNullTerminated=function(t){this.writeUTF8String(t+"\0")},e.prototype.expandBuffer=function(e){for(var r=8*this.bytes.length;this.bitOffset+e>r;)r*=2;var i=new Uint8Array(Math.ceil(r/8));i.set(this.bytes),this.bytes=i,this.view=new t.DataView2(i)},e}();t.BitWriter=e})(Mp4||(Mp4={}));var Mp4;(function(t){t.BOX_TYPE_FILE_TYPE_BOX="ftyp",t.BOX_TYPE_MOVIE_BOX="moov",t.BOX_TYPE_MEDIA_DATA_BOX="mdat",t.BOX_TYPE_MOVIE_HEADER_BOX="mvhd",t.BOX_TYPE_TRACK_BOX="trak",t.BOX_TYPE_TRACK_HEADER_BOX="tkhd",t.BOX_TYPE_TRACK_REFERENCE_BOX="tref",t.BOX_TYPE_HINT_TRACK_REFERENCE_TYPE_BOX="hint",t.BOX_TYPE_DISCRIBE_TRACK_REFERENCE_TYPE_BOX="cdsc",t.BOX_TYPE_MEDIA_BOX="mdia",t.BOX_TYPE_MEDIA_HEADER_BOX="mdhd",t.BOX_TYPE_HANDLER_BOX="hdlr",t.BOX_TYPE_MEDIA_INFORMATION_BOX="minf",t.BOX_TYPE_VIDEO_MEDIA_HEADER_BOX="vmhd",t.BOX_TYPE_SOUND_MEDIA_HEADER_BOX="smhd",t.BOX_TYPE_HINT_MEDIA_HEADER_BOX="hmhd",t.BOX_TYPE_NULL_MEDIA_HEADER_BOX="nmhd",t.BOX_TYPE_DATA_INFORMATION_BOX="dinf",t.BOX_TYPE_DATA_REFERENCE_BOX="dref",t.BOX_TYPE_DATA_ENTRY_URL_BOX="url ",t.BOX_TYPE_DATA_ENTRY_URN_BOX="urn ",t.BOX_TYPE_SAMPLE_TABLE_BOX="stbl",t.BOX_TYPE_TIME_TO_SAMPLE_BOX="stts",t.BOX_TYPE_COMPOSITION_OFFSET_BOX="ctts",t.BOX_TYPE_ES_DESCRIPTOR_BOX="esds",t.BOX_TYPE_MP4_VISUAL_SAMPLE_ENTRY="mp4v",t.BOX_TYPE_MP4_AUDIO_SAMPLE_ENTRY="mp4a",t.BOX_TYPE_MPEG_SAMPLE_ENTRY="mp4s",t.BOX_TYPE_SAMPLE_DESCRIPTION_BOX="stsd",t.BOX_TYPE_SAMPLE_SIZE_BOX="stsz",t.BOX_TYPE_SAMPLE_TO_CHUNK_BOX="stsc",t.BOX_TYPE_CHUNK_OFFSET_BOX="stco",t.BOX_TYPE_SYNC_SAMPLE_BOX="stss",t.BOX_TYPE_SHADOW_SYNC_SAMPLE_BOX="stsh",t.BOX_TYPE_DEGRADATION_PRIORITY_BOX="stdp",t.BOX_TYPE_PADDING_BITS_BOX="padb",t.BOX_TYPE_FREE_SPACE_BOX="free",t.BOX_TYPE_SKIP_BOX="skip",t.BOX_TYPE_EDIT_BOX="edts",t.BOX_TYPE_EDIT_LIST_BOX="elst",t.BOX_TYPE_COPYRIGHT_BOX="cprt",t.BOX_TYPE_MOVIE_EXTENDS_BOX="mvex",t.BOX_TYPE_MOVIE_EXTENDS_HEADER_BOX="mehd",t.BOX_TYPE_TRACK_EXTENDS_BOX="trex",t.BOX_TYPE_MOVIE_FLAGMENT_BOX="moof",t.BOX_TYPE_MOVIE_FRAGMENT_HEADER_BOX="mfhd",t.BOX_TYPE_TRACK_FRAGMENT_BOX="traf",t.BOX_TYPE_TRACK_FRAGMENT_HEADER_BOX="tfhd",t.BOX_TYPE_TRACK_RUN_BOX="trun",t.BOX_TYPE_TRACK_FRAGMENT_RANDOM_ACCESS_BOX="tfra",t.BOX_TYPE_MOVIE_FRAGMENT_RANDOM_ACCESS_OFFSET_BOX="mfro",t.BOX_TYPE_SAMPLE_DEPENDENCY_TYPE_BOX="sdtp",t.BOX_TYPE_SAMPLE_TO_GROUPE_BOX="sbgp",t.BOX_TYPE_SAMPLE_GROUP_DESCRIPTION_BOX="sgpd",t.BOX_TYPE_ROLL_RECOVERY_ENTRY="roll",t.BOX_TYPE_SAMPLE_SCALE_BOX="stsl",t.BOX_TYPE_SUB_SAMPLE_INFORMATION_BOX="subs",t.BOX_TYPE_PROGRESSIVE_DOWNLOAD_INFO_BOX="pdin",t.BOX_TYPE_META_BOX="meta",t.BOX_TYPE_XML_BOX="xml ",t.BOX_TYPE_BINARY_XML_BOX="bxml",t.BOX_TYPE_ITEM_LOCATION_BOX="iloc",t.BOX_TYPE_PRIMARY_ITEM_BOX="pitm",t.BOX_TYPE_ITEM_PROTECTION_BOX="ipro",t.BOX_TYPE_ITEM_INFO_ENTRY="infe",t.BOX_TYPE_ITEM_INFO_BOX="iinf",t.BOX_TYPE_PROTECTION_SCHEME_INFO_BOX="sinf",t.BOX_TYPE_ORIGINAL_FORMAT_BOX="frma",t.BOX_TYPE_IPMP_INFO_BOX="imif",t.BOX_TYPE_IPMP_CONTROL_BOX="impc",t.DESCR_TAG_ES_DESCRIPTOR=3,t.DESCR_TAG_DECODER_CONFIG_DESCRIPTOR=4,t.DESCR_TAG_DECODER_SPECIFIC_INFO=5,t.DESCR_TAG_SL_CONFIG_DESCRIPTOR=6,t.DESCR_TAG_PROFILE_LEVEL_INDICATION_INDEX_DESCRIPTOR=20})(Mp4||(Mp4={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r},Mp4;(function(t){(function(e){var r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){throw Error("not implemented error.")},e}(t.BitReader);e.BaseParser=r})(t.Parser||(t.Parser={})),t.Parser})(Mp4||(Mp4={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r},Mp4;(function(t){(function(e){e.getDescriptorInfo=function(t,e){e===void 0&&(e=0);for(var r=t[e++],i=t[e++],n=127&i,s=2;128&i;)s++,i=t[e++],n<<=7,n|=127&i;return{tag:r,byteLength:s+n,headerLength:s,bodyLength:n}};var r=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.readDescriptor=function(){var t=e.getDescriptorInfo(this.bytes,this.byteOffset);return e.createDescriptorParser(this.readBytes(t.byteLength),t.tag).parse()},r}(e.BaseParser);e.DescriptorParserMixin=r;var i=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.parse=function(){var t=e.getDescriptorInfo(this.bytes);return this.skipBytes(t.headerLength),t.bytes=this.bytes,t},r}(r);e.DescriptorParser=i;var n=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TAG=t.DESCR_TAG_DECODER_SPECIFIC_INFO,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.data=this.bytes.subarray(this.byteOffset),t},r}(i);e.DecoderSpecificInfoParser=n;var s=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TAG=t.DESCR_TAG_PROFILE_LEVEL_INDICATION_INDEX_DESCRIPTOR,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.profileLevelIndicationIndex=this.readUint8(),t},r}(i);e.ProfileLevelINdicationIndexDescriptor=s;var a=function(r){function i(){r.apply(this,arguments)}return __extends(i,r),i.TAG=t.DESCR_TAG_DECODER_CONFIG_DESCRIPTOR,i.OBJECT_TYPE_INDICATION={MP3:107,AAC:64},i.prototype.parse=function(){var t=r.prototype.parse.call(this);t.objectTypeIndication=this.readUint8(),t.streamType=this.readBits(6),t.upStream=this.readBits(1),this.skipBits(1),t.bufferSizeDB=this.readUint24(),t.maxBitrate=this.readUint32(),t.avgBitrate=this.readUint32();var i,a,o;for(t.profileLevelIndicationIndexDescrs=[];!this.eof();)if(i=e.getDescriptorInfo(this.bytes.subarray(this.byteOffset)),a=e.createDescriptorParser(this.readBytes(i.byteLength),i.tag),o=a.parse(),a instanceof n)t.decSpecificInfo=o;else{if(!(a instanceof s))throw new TypeError;t.profileLevelIndicationIndexDescrs.push(o)}return t},i}(i);e.DecoderConfigDescriptorParser=a;var o=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TAG=t.DESCR_TAG_SL_CONFIG_DESCRIPTOR,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.preDefined=this.readUint8(),0===t.preDefined&&(t.useAccessUnitStartFlag=this.readBits(1),t.useAccessUnitEndFlag=this.readBits(1),t.useRandomAccessPointFlag=this.readBits(1),t.hasRandomAccessUnitsOnlyFlag=this.readBits(1),t.usePaddingFlag=this.readBits(1),t.useTimeStampsFlag=this.readBits(1),t.useIdleFlag=this.readBits(1),t.durationFlag=this.readBits(1),t.timeStampResolution=this.readUint32(),t.ocrResolution=this.readUint32(),t.timeStampLength=this.readUint8(),t.ocrLength=this.readUint8(),t.auLength=this.readUint8(),t.instantBitrateLength=this.readUint8(),t.degradationPriorityLength=this.readBits(4),t.auSeqNumLength=this.readBits(5),t.packetSeqNumLength=this.readBits(5),this.skipBits(2)),t.durationFlag&&(t.timeScale=this.readUint32(),t.accessUnitDuration=this.readUint16(),t.compositionUnitDuration=this.readUint16()),0===t.useTimeStampsFlag&&(t.startDecodingTimeStamp=this.readBits(t.timeStampLength),t.startCompositionTimeStamp=this.readBits(t.timeStampLength)),t},r}(i);e.SLConfigDescriptorParser=o;var p=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(i);e.IPIDescriptorPointerParser=p;var u=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(i);e.IPIdentificationDataSetParser=u;var _=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(i);e.IPMPDescriptorPointerParser=_;var h=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(i);e.LanguageDescriptorParser=h;var c=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(i);e.QosDescriptorParser=c;var f=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(i);e.ExtensionDescriptorParser=f;var l=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TAG=t.DESCR_TAG_ES_DESCRIPTOR,r.prototype.parse=function(){var r,i=e.prototype.parse.call(this);for(i.esID=this.readUint16(),i.streamDependenceFlag=this.readBits(1),i.urlFlag=this.readBits(1),i.ocrStreamFlag=this.readBits(1),i.streamPriority=this.readBits(5),i.streamDependenceFlag&&(i.dependsOnEsID=this.readUint16()),i.urlFlag&&(i.urlLength=this.readUint8(),i.urlString=this.readString(i.urlLength)),i.ocrStreamFlag&&(i.ocrEsID=this.readUint16());!this.eof();)switch(r=this.readDescriptor(),r.tag){case t.DESCR_TAG_DECODER_CONFIG_DESCRIPTOR:i.decConfigDescr=r;break;case t.DESCR_TAG_SL_CONFIG_DESCRIPTOR:i.slConfigDescr=r}return i},r}(i);e.ESDescriptorParser=l;var E=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.TAG=[2,16],e.prototype.parse=function(){var e=t.prototype.parse.call(this);if(e.objectDescrID=this.readBits(10),e.urlFlag=this.readBits(1),e.includeInlineProfileLevelFlag=this.readBits(1),this.skipBits(4),e.urlFlag?(e.urlLength=this.readUint8(),e.urlString=this.readString(e.urlLength)):(e.odProfileLevelIndication=this.readUint8(),e.sceneProfileLevelIndication=this.readUint8(),e.audioProfileLevelIndication=this.readUint8(),e.visualProfileLevelIndication=this.readUint8(),e.graphicsProfileLevelIndication=this.readUint8()),e.extDescrs=[],e.urlFlag)for(;!this.eof();)e.extDescrs.push(this.readDescriptor());return e},e}(i);e.InitialObjectDescriptorParser=E,e.createDescriptorParser=function(e,r){var n;return Object.keys(t.Parser).some(function(e){var i=t.Parser[e];return i.TAG===r||Array.isArray(i)&&i.some(function(t){return i.TAG===t})?(n=i,!0):void 0}),new(n||i)(e)}})(t.Parser||(t.Parser={})),t.Parser})(Mp4||(Mp4={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r},Mp4;(function(t){(function(e){var r=function(e,r){r===void 0&&(r=0);var i=new t.DataView2(e,r);return{byteLength:i.getUint32(0),type:i.getString(4,4)}},i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.readBox=function(){var t=r(this.bytes,this.byteOffset);return e.createBoxParser(this.readBytes(t.byteLength),t.type).parse()},i}(e.DescriptorParserMixin);e.BoxParserMixin=i;var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){for(var t=[];!this.eof();)t.push(this.readBox());return t},e}(i);e.RootParser=n;var s=function(t){function e(e){t.call(this,e),this.byteLength=this.bytes.length,this.skipBytes(4),this.type=this.readString(4)}return __extends(e,t),e.prototype.parse=function(){return{byteLength:this.byteLength,type:this.type,bytes:this.bytes}},e}(i);e.BoxParser=s;var a=function(t){function e(e){t.call(this,e),this.version=this.readUint8(),this.flags=this.readUint24()}return __extends(e,t),e.prototype.parse=function(){var e=t.prototype.parse.call(this);return e.version=this.version,e.flags=this.flags,e},e}(s);e.FullBoxParser=a;var o=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_FILE_TYPE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);for(t.majorBrand=this.readString(4),t.minorVersion=this.readUint32(),t.compatibleBrands=[];!this.eof();)t.compatibleBrands.push(this.readString(4));return t},r}(s);e.FileTypeBoxParser=o;var p=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){for(var e=t.prototype.parse.call(this),r=[];!this.eof();)r.push(this.readBox());return e.boxes=r,e},e}(s);e.BoxListParser=p;var u=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_BOX,r}(p);e.MovieBoxParser=u;var _=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_DATA_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.data=this.bytes.subarray(8),t},r}(s);e.MediaDataBoxParser=_;var h=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);t.matrix=[],t.creationTime=this.readUint32(),t.modificationTime=this.readUint32(),t.timescale=this.readUint32(),t.duration=this.readUint32(),t.rate=this.readUint32(),t.volume=this.readUint16(),this.skipBytes(2),this.skipBytes(8);for(var r=0;9>r;++r)t.matrix.push(this.readInt32());return this.skipBytes(24),t.nextTrackID=this.readUint32(),t},r}(a);e.MovieHeaderBoxParser=h;var c=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_BOX,r}(p);e.TrackBoxParser=c;var f=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);t.matrix=[],t.creationTime=this.readUint32(),t.modificationTime=this.readUint32(),t.trackID=this.readUint32(),this.skipBytes(4),t.duration=this.readUint32(),this.skipBytes(8),t.layer=this.readInt16(),t.alternateGroup=this.readInt16(),t.volume=this.readInt16()/256,this.skipBytes(2);for(var r=0;9>r;++r)t.matrix.push(this.readInt32());return t.width=this.readUint32()/65536,t.height=this.readUint32()/65536,t},r}(a);e.TrackHeaderBoxParser=f;var l=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_REFERENCE_BOX,r}(p);e.TrackReferenceBox=l;var E=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){var e=t.prototype.parse.call(this);for(e.trackIDs=[];!this.eof();)e.trackIDs.push(this.readUint32());return e},e}(s);e.TrackReferenceTypeBox=E;var d=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_HINT_TRACK_REFERENCE_TYPE_BOX,r}(E);e.HintTrackReferenceTypeBox=d;var B=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DISCRIBE_TRACK_REFERENCE_TYPE_BOX,r}(E);e.DescribeTrackReferenceTypeBox=B;var y=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_BOX,r}(p);e.MediaBoxParser=y;var O=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.creationTime=this.readUint32(),t.modificationTime=this.readUint32(),t.timescale=this.readUint32(),t.duration=this.readUint32(),this.skipBits(1),t.language=String.fromCharCode.apply(null,[this.readBits(5),this.readBits(5),this.readBits(5)].map(function(t){return t+96})),t},r}(a);e.MediaHeaderBoxParser=O;var T=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_HANDLER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return this.skipBytes(4),t.handlerType=this.readString(4),this.skipBytes(12),t.name=this.readUTF8StringNullTerminated(),t},r}(a);e.HandlerBoxParser=T;var m=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_INFORMATION_BOX,r}(p);e.MediaInformationBoxParser=m;var P=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_VIDEO_MEDIA_HEADER_BOX,r.prototype.parse=function(){var r=e.prototype.parse.call(this);new t.DataView2(this.bytes),r.opcolor=[],r.graphicsmode=this.readUint16();for(var i=0;3>i;++i)r.opcolor.push(this.readUint16());return r},r}(a);e.VideoMediaHeaderBoxParser=P;var v=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SOUND_MEDIA_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.balance=this.readInt16(),t},r}(a);e.SoundMediaHeaderBoxParser=v;var g=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_HINT_MEDIA_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.maxPDUsize=this.readUint16(),t.avgPDUsize=this.readUint16(),t.maxbitrate=this.readUint32(),t.avgbitrate=this.readUint32(),t},r}(a);e.HintMediaHeaderBoxParser=g;var I=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_NULL_MEDIA_HEADER_BOX,r}(a);e.NullMediaHeaderBoxParser=I;var C=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_INFORMATION_BOX,r}(p);e.DataInformationBoxParser=C;var X=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_REFERENCE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);for(t.entryCount=this.readUint32(),t.entries=[];!this.eof();)t.entries.push(this.readBox());return t},r}(a);e.DataReferenceBoxParser=X;var x=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_ENTRY_URL_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.location=this.readUTF8StringNullTerminated(),t},r}(a);e.DataEntryUrlBoxParser=x;var S=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_ENTRY_URN_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.name=this.readUTF8StringNullTerminated(),t.location=this.readUTF8StringNullTerminated(),t},r}(a);e.DataEntryUrnBoxParser=S;var D=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_TABLE_BOX,r}(p);e.SampleTableBoxParser=D;var U=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TIME_TO_SAMPLE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push({sampleCount:this.readUint32(),sampleDelta:this.readUint32()});return t},r}(a);e.TimeToSampleBoxParser=U;var Y=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_COMPOSITION_OFFSET_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push({sampleCount:this.readUint32(),sampleOffset:this.readUint32()});return t},r}(a);e.CompositionOffsetBoxParser=Y;var A=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){var e=t.prototype.parse.call(this);return this.skipBytes(6),e.dataReferenceIndex=this.readUint16(),e},e}(s);e.SampleEntryParser=A;var w=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){var e=t.prototype.parse.call(this);return e.data=this.bytes.subarray(16),e},e}(A);e.HintSampleEntryParser=w;var R=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){var e=t.prototype.parse.call(this);return this.skipBytes(16),e.width=this.readUint16(),e.height=this.readUint16(),e.horizresolution=this.readUint32(),e.vertresolution=this.readUint32(),e.compressorname=this.readString(32),e.depth=this.readUint16(),e},e}(A);e.VisualSampleEntryParser=R;var b=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(){var e=t.prototype.parse.call(this);return this.skipBytes(8),e.channelCount=this.readUint16(),e.sampleSize=this.readUint16(),this.skipBytes(4),e.sampleRate=this.readUint32()/65536,e},e}(A);e.AudioSampleEntryParser=b;var M=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ES_DESCRIPTOR_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.esDescr=this.readDescriptor(),t},r}(a);e.ESDBoxParser=M;var N=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MP4_VISUAL_SAMPLE_ENTRY,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.esBox=this.readBox(),t},r}(R);e.MP4VisualSampleEntryParser=N;var F=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MP4_AUDIO_SAMPLE_ENTRY,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.esBox=this.readBox(),t},r}(b);e.MP4AudioSampleEntryParser=F;var L=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MPEG_SAMPLE_ENTRY,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.esBox=this.readBox(),t},r}(A);e.MpegSampleEntryParser=L;var k=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_DESCRIPTION_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.boxes=[];for(var i=0;r>i;++i)t.boxes.push(this.readBox());return t},r}(a);e.SampleDescriptionBoxParser=k;var H=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_SIZE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32(),i=this.readUint32();if(0===r){t.sampleSizes=[];for(var n=0;i>n;++n)t.sampleSizes.push(this.readUint32())}return t.sampleSize=r,t.sampleCount=i,t},r}(a);e.SampleSizeBoxParser=H;var G=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_TO_CHUNK_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push({firstChunk:this.readUint32(),samplesPerChunk:this.readUint32(),sampleDescriptionIndex:this.readUint32()});return t},r}(a);e.SampleToChunkBoxParser=G;var V=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_CHUNK_OFFSET_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.chunkOffsets=[];for(var i=0;r>i;++i)t.chunkOffsets.push(this.readUint32());return t},r}(a);e.ChunkOffsetBoxParser=V;var z=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SYNC_SAMPLE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.sampleNumbers=[];for(var i=0;r>i;++i)t.sampleNumbers.push(this.readUint32());return t},r}(a);e.SyncSampleBoxParser=z;var K=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SHADOW_SYNC_SAMPLE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push({shadowedSampleNumber:this.readUint32(),syncSampleNumber:this.readUint32()});
return t},r}(a);e.ShadowSyncSampleBoxParser=K;var j=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DEGRADATION_PRIORITY_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);for(t.priorities=[];!this.eof();)t.priorities.push(this.readUint16());return t},r}(a);e.DegradationPriorityBoxParser=j;var q=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_PADDING_BITS_BOX,r.prototype.parse=function(){var t,r,i=e.prototype.parse.call(this),n=this.readUint32();i.sampleCount=n,i.samples=[];for(var s=0;n>s;++s)this.skipBits(1),t=this.readBits(3),this.skipBits(1),r=this.readBits(3),i.samples.push({pad1:t,pad2:r});return i},r}(a);e.PaddingBitsBoxParser=q;var W=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_FREE_SPACE_BOX,r}(y);e.FreeSpaceBoxParser=W;var Z=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SKIP_BOX,r}(y);e.SkipBoxParser=Z;var J=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_EDIT_BOX,r}(p);e.EditBoxParser=J;var Q=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_EDIT_LIST_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push({sagmentDuration:this.readUint32(),mediaTime:this.readUint32(),mediaRateInteger:this.readUint16()}),this.skipBytes(2);return t},r}(a);e.EditListBoxParser=Q;var $=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_COPYRIGHT_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return this.skipBits(1),t.language=String.fromCharCode(this.readBits(5),this.readBits(5),this.readBits(5)),t.notice=this.readUTF8StringNullTerminated(),t},r}(a);e.CopyrightBoxParser=$;var te=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_EXTENDS_BOX,r}(p);e.MovieExtendsBoxParser=te;var ee=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_EXTENDS_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.fragmentDuration=this.readUint32(),t},r}(a);e.MovieExtendsHeaderBoxParser=ee;var re=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_EXTENDS_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.trackID=this.readUint32(),t.defaultSampleDescriptionIndex=this.readUint32(),t.defaultSampleDuration=this.readUint32(),t.defaultSampleSize=this.readUint32(),t.defaultSampleFlags=this.readUint32(),t},r}(a);e.TrackExtendsBoxParser=re;var ie=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_FLAGMENT_BOX,r}(p);e.MovieFlagmentBoxParser=ie;var ne=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_FRAGMENT_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.sequenceNumber=this.readUint32(),t},r}(a);e.MovieFragmentHeaderBoxParser=ne;var se=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_FRAGMENT_BOX,r}(p);e.TrackFragmentBoxParser=se;var ae=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_FRAGMENT_HEADER_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.trackID=this.readUint32(),1&t.flags&&(t.baseDataOffset=this.readBytes(8)),2&t.flags&&(t.sampleDescriptionIndex=this.readUint32()),8&t.flags&&(t.defaultSampleDuration=this.readUint32()),16&t.flags&&(t.defaultSampleSize=this.readUint32()),32&t.flags&&(t.defaultSampleFlags=this.readUint32()),t},r}(a);e.TrackFragmentHeaderBoxParser=ae;var oe=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_RUN_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.sampleCount=r,1&t.flags&&(t.dataOffset=this.readInt32()),2&t.flags&&(t.firstSampleFlats=this.readUint32()),t.samples=[];for(var i=0;r>i;++i)t.samples.push({sampleDuration:256&t.flags?this.readUint32():void 0,sampleSize:512&t.flags?this.readUint32():void 0,sampleFlags:1024&t.flags?this.readUint32():void 0,sampleCompositionTimeOffset:2048&t.flags?this.readUint32():void 0});return t},r}(a);e.TrackRunBoxParser=oe;var pe=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_FRAGMENT_RANDOM_ACCESS_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);t.trackID=this.readUint32(),this.skipBits(26),t.lengthSizeOfTrafNum=this.readBits(2),t.lengthSizeOfTrunNum=this.readBits(2),t.lengthSizeOfSampleNum=this.readBits(2);var r=this.readUint32();t.numberOfEntry=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push({time:this.readUint32(),moofOffset:this.readUint32(),trafNumber:this.readBits(8*(t.lengthSizeOfTrafNum+1)),trunNumber:this.readBits(8*(t.lengthSizeOfTrunNum+1)),sampleNumber:this.readBits(8*(t.lengthSizeOfSampleNum+1))});return t},r}(a);e.TrackFragmentRandomAccessBoxParser=pe;var ue=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_FRAGMENT_RANDOM_ACCESS_OFFSET_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.size=this.readUint32(),t},r}(a);e.MovieFragmentRandomAccessOffsetBoxParser=ue;var _e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_DEPENDENCY_TYPE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);for(t.samples=[];!this.eof();)this.skipBits(2),t.samples.push({sampleDependsOn:this.readBits(2),sampleIsDependedOn:this.readBits(2),sampleHasRedundancy:this.readBits(2)});return t},r}(a);e.SampleDependencyTypeBoxParser=_e;var he=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_TO_GROUPE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);t.groupintType=this.readUint32();var r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push({sampleCount:this.readUint32(),groupDescriptionIndex:this.readUint32()});return t},r}(a);e.SampleToGroupBoxParser=he;var ce=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(s);e.SampleGroupDescriptionEntryParser=ce;var fe=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ce);e.VisualSampleGroupEntryParser=fe;var le=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ce);e.AudioSampleGroupEntryParser=le;var Ee=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ce);e.HintSampleGroupEntryParser=Ee;var de=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_GROUP_DESCRIPTION_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);t.groupingType=this.readUint32();var r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i)t.entries.push(this.readBox());return t},r}(a);e.SampleGroupDescriptionBoxParser=de;var Be=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ROLL_RECOVERY_ENTRY,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.rollDistance=this.readInt16(),t},r}(fe);e.VisualRollRecoveryEntryParser=Be;var ye=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ROLL_RECOVERY_ENTRY,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.rollDistance=this.readInt16(),t},r}(fe);e.AudioRollRecoveryEntryParser=ye;var Oe=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_SCALE_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return this.skipBits(7),t.constraintFlag=this.readBits(1),t.scaleMethod=this.readUint8(),t.displayCenterX=this.readInt16(),t.displayCenterY=this.readInt16(),t},r}(a);e.SampleScaleBoxParser=Oe;var Te=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SUB_SAMPLE_INFORMATION_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=this.readUint32();t.entryCount=r,t.entries=[];for(var i=0;r>i;++i){for(var n=this.readUint32(),s=this.readUint16(),a=[],o=0;s>o;++o)a.push({subsampleSize:1===t.version?this.readUint32():this.readUint16(),subsamplePriority:this.readUint8(),discardable:this.readUint8()}),this.skipBytes(4);t.entries.push({sampleDelta:n,subsampleCount:s,samples:a})}return t},r}(a);e.SubSampleInformationBoxParser=Te;var me=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_PROGRESSIVE_DOWNLOAD_INFO_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);for(t.entries=[];!this.eof();)t.entries.push({rate:this.readUint32(),initialDelay:this.readUint32()});return t},r}(a);e.ProgressiveDownloadInfoBoxParser=me;var Pe=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_META_BOX,r.prototype.parse=function(){var r=e.prototype.parse.call(this);for(r.theHandler=this.readBox(),r.otherBoxes=[];!this.eof();){var i=this.readBox();switch(i.type){case t.BOX_TYPE_PRIMARY_ITEM_BOX:r.primaryResource=i;break;case t.BOX_TYPE_DATA_INFORMATION_BOX:r.fileLocations=i;break;case t.BOX_TYPE_ITEM_LOCATION_BOX:r.itemLocations=i;break;case t.BOX_TYPE_ITEM_INFO_BOX:r.itemInfos=i;break;case t.BOX_TYPE_ITEM_PROTECTION_BOX:r.protections=i;break;case t.BOX_TYPE_IPMP_CONTROL_BOX:r.IPMPControl=i;break;default:r.otherBoxes.push(i)}}return r},r}(a);e.MetaBoxParser=Pe;var ve=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_XML_BOX,r.prototype.parse=function(){var r=e.prototype.parse.call(this),i=this.bytes.subarray(this.byteOffset);return r.xml=t.DataView2.UTF8BytesToString(i),r},r}(a);e.XMLBoxParsr=ve;var ge=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_BINARY_XML_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.data=this.bytes.subarray(this.byteOffset),t},r}(a);e.BinaryXMLBoxParser=ge;var Ie=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ITEM_LOCATION_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);t.offsetSize=this.readBits(4),t.lengthSize=this.readBits(4),t.baseOffsetSize=this.readBits(4),this.skipBits(4);var r=t.itemCount=this.readUint16();t.items=[];for(var i=0;r>i;++i){for(var n=this.readUint16(),s=this.readUint16(),a=this.readBits(8*t.baseOffsetSize),o=this.readUint16(),p=[],u=0;o>u;++u)p.push({extentOffset:this.readBits(8*t.offsetSize),extentLength:this.readBits(8*t.lengthSize)});t.items.push({itemID:n,dataReferenceIndex:s,baseOffset:a,extentCount:o,extents:p})}return t},r}(a);e.ItemLocationBoxParser=Ie;var Ce=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_PRIMARY_ITEM_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.itemID=this.readUint16(),t},r}(a);e.PrimaryItemBoxParser=Ce;var Xe=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ITEM_PROTECTION_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=t.protectionCount=this.readUint16();t.protectionInformations=[];for(var i=0;r>i;++i)t.protectionInformations.push(this.readBox());return t},r}(a);e.ItemProtectionBoxParser=Xe;var xe=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ITEM_INFO_ENTRY,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.itemID=this.readUint16(),t.itemProtectionIndex=this.readUint16(),t.itemName=this.readUTF8StringNullTerminated(),t.contentType=this.readUTF8StringNullTerminated(),t.contentEncoding=this.readString(),t},r}(a);e.ItemInfoEntryParser=xe;var Se=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ITEM_INFO_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this),r=t.entryCount=this.readUint16();t.itemInfos=[];for(var i=0;r>i;++i)t.itemInfos.push(this.readBox());return t},r}(a);e.ItemInfoBoxParser=Se;var De=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_PROTECTION_SCHEME_INFO_BOX,r.prototype.parse=function(){var r=e.prototype.parse.call(this);for(r.originalFormat=this.readBox();!this.eof();){var i=this.readBox();switch(i.type){case t.BOX_TYPE_IPMP_INFO_BOX:r.IPMPDescriptors=i}}return r},r}(s);e.ProtectionSchemeInfoBoxParser=De;var Ue=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ORIGINAL_FORMAT_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);return t.dataFormat=this.readString(4),t},r}(s);e.OriginalFormatBoxParser=Ue;var Ye=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_IPMP_INFO_BOX,r.prototype.parse=function(){var t=e.prototype.parse.call(this);for(t.ipmpDescrs=[];!this.eof();)t.ipmpDescrs.push(this.readDescriptor());return t},r}(a);e.IPMPInfoBoxParser=Ye,e.createBoxParser=function(e,r){var i;return Object.keys(t.Parser).some(function(e){return t.Parser[e].TYPE===r?(i=t.Parser[e],!0):void 0}),new(i||s)(e)}})(t.Parser||(t.Parser={})),t.Parser})(Mp4||(Mp4={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r},Mp4;(function(t){(function(e){var r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.compose=function(){return this.data},e}(t.BitWriter);e.BaseComposer=r})(t.Composer||(t.Composer={})),t.Composer})(Mp4||(Mp4={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r},Mp4;(function(t){(function(e){var r=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.writeDescriptor=function(t){var r;r=t instanceof Uint8Array?t:t.bytes?t.bytes:e.createDescriptorComposer(t).compose(),this.writeBytes(r)},r}(e.BaseComposer);e.DescriptorComposerMixin=r;var i=function(t){function e(){t.call(this),this.writeUint8(this.constructor.TAG),this.writeBytes(new Uint8Array(4))}return __extends(e,t),e.prototype.compose=function(){return this.writeBodyLength(),t.prototype.compose.call(this)},e.prototype.writeBodyLength=function(){for(var t=[128,128,128,0],e=this.byteOffset-5,r=3;e;)t[r--]|=127&e,e>>>=7;this.bytes.set(t,1)},e}(r);e.DescriptorComposer=i;var n=function(e){function r(r){var i=this;e.call(this),this.writeUint8(r.objectTypeIndication),this.writeBits(r.streamType,6),this.writeBits(r.upStream,1),this.writeBits(1,1),this.writeUint24(r.bufferSizeDB),this.writeUint32(r.maxBitrate),this.writeUint32(r.avgBitrate),r.decSpecificInfo.tag=t.DESCR_TAG_DECODER_SPECIFIC_INFO,this.writeDescriptor(r.decSpecificInfo),r.profileLevelIndicationIndexDescrs&&r.profileLevelIndicationIndexDescrs.forEach(function(e){e.tag=t.DESCR_TAG_PROFILE_LEVEL_INDICATION_INDEX_DESCRIPTOR,i.writeDescriptor(e)})}return __extends(r,e),r.TAG=t.DESCR_TAG_DECODER_CONFIG_DESCRIPTOR,r}(i);e.DecoderConfigDescriptorComposer=n;var s=function(e){function r(t){e.call(this),this.writeUint8(t.preDefined),0===t.preDefined&&(this.writeBits(t.useAccessUnitStartFlag,1),this.writeBits(t.useAccessUnitEndFlag,1),this.writeBits(t.useRandomAccessPointFlag,1),this.writeBits(t.hasRandomAccessUnitsOnlyFlag,1),this.writeBits(t.usePaddingFlag,1),this.writeBits(t.useTimeStampsFlag,1),this.writeBits(t.useTimeStampsFlag,1),this.writeBits(t.useIdleFlag,1),this.writeBits(t.durationFlag,1),this.writeUint32(t.timeStampResolution),this.writeUint32(t.ocrResolution),this.writeUint8(t.timeStampLength),this.writeUint8(t.ocrLength),this.writeUint8(t.auLength),this.writeUint8(t.instantBitrateLength),this.writeBits(t.degradationPriorityLength,4),this.writeBits(t.auSeqNumLength,5),this.writeBits(t.packetSeqNumLength,5),this.writeBits(3,2)),t.durationFlag&&(this.writeUint32(t.timeScale),this.writeUint16(t.accessUnitDuration),this.writeUint16(t.compositionUnitDuration)),0===t.useTimeStampsFlag&&(this.writeBits(t.startDecodingTimeStamp,t.timeStampLength),this.writeBits(t.startCompositionTimeStamp,t.timeStampLength))}return __extends(r,e),r.TAG=t.DESCR_TAG_SL_CONFIG_DESCRIPTOR,r}(i);e.SLConfigDescriptorComposer=s;var a=function(e){function r(t){e.call(this),this.writeBytes(t.data)}return __extends(r,e),r.TAG=t.DESCR_TAG_DECODER_SPECIFIC_INFO,r}(i);e.DecoderSpecificInfoComposer=a;var o=function(e){function r(r){e.call(this),this.writeUint16(r.esID),this.writeBits(r.streamDependenceFlag||0,1),this.writeBits(r.urlFlag||0,1),this.writeBits(r.ocrStreamFlag||0,1),this.writeBits(r.streamPriority,5),r.urlFlag&&(this.writeUint8(r.urlLength),this.writeString(r.urlString)),r.ocrStreamFlag&&this.writeUint16(r.ocrEsID),r.decConfigDescr.tag=t.DESCR_TAG_DECODER_CONFIG_DESCRIPTOR,this.writeDescriptor(r.decConfigDescr),r.slConfigDescr.tag=t.DESCR_TAG_SL_CONFIG_DESCRIPTOR,this.writeDescriptor(r.slConfigDescr)}return __extends(r,e),r.TAG=t.DESCR_TAG_ES_DESCRIPTOR,r}(i);e.ESDescriptorComposer=o,e.createDescriptorComposer=function(e){var r;return Object.keys(t.Composer).some(function(i){return t.Composer[i].TAG===e.tag?(r=t.Composer[i],!0):void 0}),new(r||i)(e)}})(t.Composer||(t.Composer={})),t.Composer})(Mp4||(Mp4={}));var __extends=this.__extends||function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r},Mp4;(function(t){(function(e){var r=function(t){function e(){t.call(this),this.skipBytes(4),this.writeString(this.constructor.TYPE)}return __extends(e,t),e.prototype.compose=function(){return this.view.setUint32(0,this.byteOffset),t.prototype.compose.call(this)},e.prototype.writeBox=function(t){var e;e=t instanceof Uint8Array?t:t.bytes?t.bytes:k(t).compose(),this.writeBytes(e)},e}(e.DescriptorComposerMixin);e.BoxComposer=r;var i=function(t){function e(e){t.call(this),this.box=e,this.writeUint8(e.version||0),this.writeUint24(e.flags||0)}return __extends(e,t),e}(r);e.FullBoxComposer=i;var n=function(t){function e(e){var r=this;t.call(this),e.forEach(function(t){return r.writeBox(t)})}return __extends(e,t),e}(r);e.BoxListComposer=n;var s=function(e){function r(t){var r=this;e.call(this),this.writeString(t.majorBrand),this.writeUint32(t.minorVersion),t.compatibleBrands.forEach(function(t){return r.writeString(t)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_FILE_TYPE_BOX,r}(r);e.FileTypeBoxComposer=s;var a=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_BOX,r}(n);e.MovieBoxComposer=a;var o=function(e){function r(t){e.call(this),this.writeBytes(t.data)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_DATA_BOX,r}(r);e.MediaDataBoxComposer=o;var p=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.creationTime),this.writeUint32(t.modificationTime),this.writeUint32(t.timescale),this.writeUint32(t.duration),this.writeInt32(65536*t.rate),this.writeInt16(256*t.volume),this.skipBytes(2),this.skipBytes(8),t.matrix.forEach(function(t){return r.writeInt32(t)}),this.skipBytes(24),this.writeUint32(t.nextTrackID)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MOVIE_HEADER_BOX,r}(i);e.MovieHeaderBoxComposer=p;var u=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_BOX,r}(n);e.TrackBoxComposer=u;var _=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.creationTime),this.writeUint32(t.modificationTime),this.writeUint32(t.trackID),this.skipBytes(4),this.writeUint32(t.duration),this.skipBytes(8),this.writeInt16(t.layer),this.writeInt16(t.alternateGroup),this.writeInt16(256*t.volume),this.skipBytes(2),t.matrix.forEach(function(t){return r.writeInt32(t)}),this.writeUint32(65536*t.width),this.writeUint32(65536*t.height)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_HEADER_BOX,r}(i);e.TrackHeaderBoxComposer=_;var h=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_TRACK_REFERENCE_BOX,r}(n);e.TrackReferenceBoxComposer=h;var c=function(t){function e(e){var r=this;t.call(this),e.trackIDs.forEach(function(t){return r.writeUint32(t)})}return __extends(e,t),e}(r);e.TrackReferenceTypeBoxComposer=c;var f=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_HINT_TRACK_REFERENCE_TYPE_BOX,r}(c);e.HintTrackReferenceTypeBoxComposer=f;var l=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DISCRIBE_TRACK_REFERENCE_TYPE_BOX,r}(c);e.DescribeTrackReferenceTypeBoxComposer=l;var E=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_BOX,r}(n);e.MediaBoxComposer=E;var d=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.creationTime),this.writeUint32(t.modificationTime),this.writeUint32(t.timescale),this.writeUint32(t.duration),this.skipBits(1),[].forEach.call(t.language,function(e,i){return r.writeBits(t.language.charCodeAt(i)-96,5)}),this.skipBytes(2)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_HEADER_BOX,r}(i);e.MediaHeaderBoxComposer=d;var B=function(e){function r(t){e.call(this,t),this.skipBytes(4),this.writeString(t.handlerType),this.skipBytes(12),this.writeUTF8StringNullTerminated(t.name)}return __extends(r,e),r.TYPE=t.BOX_TYPE_HANDLER_BOX,r}(i);e.HandlerBoxComposer=B;var y=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MEDIA_INFORMATION_BOX,r}(n);e.MediaInformationBoxComposer=y;var O=function(e){function r(t){var r=this;e.call(this,t),this.writeUint16(t.graphicsmode),t.opcolor.forEach(function(t){return r.writeUint16(t)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_VIDEO_MEDIA_HEADER_BOX,r}(i);e.VideoMediaHeaderBoxComposer=O;var T=function(e){function r(t){e.call(this,t),this.writeInt16(t.balance),this.skipBytes(2)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SOUND_MEDIA_HEADER_BOX,r}(i);e.SoundMediaHeaderBoxComposer=T;var m=function(e){function r(t){e.call(this,t),this.writeUint16(t.maxPDUsize),this.writeUint16(t.avgPDUsize),this.writeUint32(t.maxbitrate),this.writeUint32(t.avgbitrate),this.skipBytes(4)}return __extends(r,e),r.TYPE=t.BOX_TYPE_HINT_MEDIA_HEADER_BOX,r}(i);e.HintMediaHeaderBoxComposer=m;var P=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_NULL_MEDIA_HEADER_BOX,r}(i);e.NullMediaHeaderBoxComposer=P;var v=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_INFORMATION_BOX,r}(n);e.DataInformationBoxComposer=v;var g=function(e){function r(t){e.call(this,t),this.writeUTF8StringNullTerminated(t.location)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_ENTRY_URL_BOX,r}(i);e.DataEntryUrlBoxComposer=g;var I=function(e){function r(t){e.call(this,t),this.writeUTF8StringNullTerminated(t.name),this.writeUTF8StringNullTerminated(t.location)}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_ENTRY_URN_BOX,r}(i);e.DataEntryUrnBoxComposer=I;var C=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.entryCount),t.entries.forEach(function(t){return r.writeBox(t)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_DATA_REFERENCE_BOX,r}(i);e.DataReferenceBoxComposer=C;var X=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_TABLE_BOX,r}(n);e.SampleTableBoxComposer=X;var x=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.entryCount),t.entries.forEach(function(t){r.writeUint32(t.sampleCount),r.writeUint32(t.sampleDelta)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_TIME_TO_SAMPLE_BOX,r}(i);e.TimeToSampleBoxComposer=x;var S=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.entryCount),t.entries.forEach(function(t){r.writeUint32(t.sampleCount),r.writeUint32(t.sampleOffset)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_COMPOSITION_OFFSET_BOX,r}(i);e.CompositionOffsetBoxComposer=S;var D=function(t){function e(e){t.call(this),this.skipBytes(6),this.writeUint16(e.dataReferenceIndex)}return __extends(e,t),e}(r);e.SampleEntryComposer=D;var U=function(t){function e(e){t.call(this,e),this.writeBytes(e.data)}return __extends(e,t),e}(D);e.HintSampleEntryComposer=U;var Y=function(t){function e(e){t.call(this,e),this.skipBytes(2),this.skipBytes(2),this.skipBytes(12),this.writeUint16(e.width),this.writeUint16(e.height),this.writeUint32(e.horizresolution),this.writeUint32(e.vertresolution),this.skipBytes(4),this.writeUint16(e.frameCount),this.writeString(e.compressorname),this.writeUint16(e.depth),this.writeInt16(-1)}return __extends(e,t),e}(D);e.VisualSampleEntryComposer=Y;var A=function(e){function r(r){e.call(this,r),r.esBox.type=t.BOX_TYPE_ES_DESCRIPTOR_BOX,this.writeBox(r.esBox)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MP4_VISUAL_SAMPLE_ENTRY,r}(Y);e.MP4VisualSampleEntryComposer=A;var w=function(e){function r(r){e.call(this,r),r.esDescr.tag=t.DESCR_TAG_ES_DESCRIPTOR,this.writeDescriptor(r.esDescr)}return __extends(r,e),r.TYPE=t.BOX_TYPE_ES_DESCRIPTOR_BOX,r}(i);e.ESDBoxComposer=w;var R=function(t){function e(e){t.call(this,e),this.skipBytes(8),this.writeUint16(e.channelCount),this.writeUint16(e.sampleSize),this.skipBytes(2),this.skipBytes(2),this.writeUint32(65536*e.sampleRate)}return __extends(e,t),e}(D);e.AudioSampleEntryComposer=R;var b=function(e){function r(r){e.call(this,r),r.esBox.type=t.BOX_TYPE_ES_DESCRIPTOR_BOX,this.writeBox(r.esBox)}return __extends(r,e),r.TYPE=t.BOX_TYPE_MP4_AUDIO_SAMPLE_ENTRY,r}(R);e.MP4AudioSampleEntryComposer=b;var M=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.entryCount),t.boxes.forEach(function(t){return r.writeBox(t)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_DESCRIPTION_BOX,r}(i);e.SampleDescriptionBoxComposer=M;var N=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.sampleSize),this.writeUint32(t.sampleCount),0===t.sampleSize&&t.sampleSizes.forEach(function(t){return r.writeUint32(t)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_SIZE_BOX,r}(i);e.SampleSizeBoxComposer=N;var F=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.entryCount),t.entries.forEach(function(t){r.writeUint32(t.firstChunk),r.writeUint32(t.samplesPerChunk),r.writeUint32(t.sampleDescriptionIndex)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_SAMPLE_TO_CHUNK_BOX,r}(i);e.SampleToChunkBoxComposer=F;var L=function(e){function r(t){var r=this;e.call(this,t),this.writeUint32(t.entryCount),t.chunkOffsets.forEach(function(t){return r.writeUint32(t)})}return __extends(r,e),r.TYPE=t.BOX_TYPE_CHUNK_OFFSET_BOX,r}(i);e.ChunkOffsetBoxComposer=L;var k=function(e){var i;return Object.keys(t.Composer).some(function(r){return t.Composer[r].TYPE===e.type?(i=t.Composer[r],!0):void 0}),new(i||r)(e)}})(t.Composer||(t.Composer={})),t.Composer})(Mp4||(Mp4={}));var Mp4;(function(t){var e=function(){function t(t){this.tree=t}return t.prototype.findOne=function(t){var e,r=function(i){if(!e){switch(typeof i){case"number":case"string":case"boolean":return}return i.type===t?e=i:(i.buffer||Object.keys(i).forEach(function(t){var e=i[t];null!=e&&(Array.isArray(e)?e.some(r):e.type&&r(e))}),void 0)}};return r(this.tree),e},t.prototype.findAll=function(t){var e=[],r=function(i){switch(typeof i){case"number":case"string":case"boolean":return}i.type===t&&e.push(i),i.buffer||Object.keys(i).forEach(function(t){var e=i[t];null!=e&&(Array.isArray(e)?e.forEach(r):r(e))})};return r(this.tree),e},t}();t.Finder=e})(Mp4||(Mp4={}));var Mp4;(function(t){var e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3];t.parse=function(e){return new t.Parser.RootParser(e).parse()};var r=function(e,r){var i,n,s,a,o,p,u,_,h,c=[],f=new t.Finder(r),l=f.findOne(t.BOX_TYPE_SAMPLE_TO_CHUNK_BOX),E=f.findOne(t.BOX_TYPE_SAMPLE_SIZE_BOX),d=f.findOne(t.BOX_TYPE_CHUNK_OFFSET_BOX);for(i=0,a=0,o=l.entryCount;o>i;++i)for(n=l.entries[i].firstChunk-1,p=o>i+1?l.entries[i+1].firstChunk-1:d.chunkOffsets.length;p>n;++n){for(_=h=d.chunkOffsets[n],s=0,u=l.entries[i].samplesPerChunk;u>s;++s,++a)h+=E.sampleSizes[a];c.push(e.subarray(_,h))}return c},i=function(e){var r,i=new t.Finder(e);return i.findAll(t.BOX_TYPE_TRACK_BOX).some(function(e){var i=new t.Finder(e).findOne(t.BOX_TYPE_HANDLER_BOX);return"soun"===i.handlerType?r=e:void 0}),r},n=function(t){var e,r,i=0,n=0;for(e=0,r=t.length;r>e;++e)i+=t[e].length;var s=new Uint8Array(i);for(e=0;r>e;++e)s.set(t[e],n),n+=t[e].length;return s};t.extractAudio=function(e){var s=t.parse(e),a=new t.Finder(s),o=48,p={majorBrand:"M4A ",minorVersion:1,compatibleBrands:["isom","M4A ","mp42"]};p.bytes=new t.Composer.FileTypeBoxComposer(p).compose(),o+=p.bytes.length;var u=a.findOne(t.BOX_TYPE_MOVIE_HEADER_BOX);o+=u.bytes.length;var _=i(s);a=new t.Finder(_);var h=a.findOne(t.BOX_TYPE_TRACK_HEADER_BOX);o+=h.bytes.length,a=new t.Finder(a.findOne(t.BOX_TYPE_MEDIA_BOX));var c=a.findOne(t.BOX_TYPE_MEDIA_HEADER_BOX),f=a.findOne(t.BOX_TYPE_HANDLER_BOX);o+=c.bytes.length+f.bytes.length,a=new t.Finder(a.findOne(t.BOX_TYPE_MEDIA_INFORMATION_BOX));var l=a.findOne(t.BOX_TYPE_SOUND_MEDIA_HEADER_BOX),E=a.findOne(t.BOX_TYPE_DATA_INFORMATION_BOX);o+=l.bytes.length+E.bytes.length,a=new t.Finder(a.findOne(t.BOX_TYPE_SAMPLE_TABLE_BOX));var d=a.findOne(t.BOX_TYPE_SAMPLE_DESCRIPTION_BOX),B=a.findOne(t.BOX_TYPE_TIME_TO_SAMPLE_BOX),y=a.findOne(t.BOX_TYPE_SAMPLE_TO_CHUNK_BOX),O=a.findOne(t.BOX_TYPE_SAMPLE_SIZE_BOX),T=a.findOne(t.BOX_TYPE_CHUNK_OFFSET_BOX),m=T.bytes;o+=d.bytes.length+B.bytes.length+y.bytes.length+O.bytes.length+m.length;for(var P=r(e,_),v=[o],g=1,I=P.length;I>g;++g)o+=P[g-1].length,v[g]=o;m=new t.Composer.ChunkOffsetBoxComposer({entryCount:T.entryCount,chunkOffsets:v}).compose();var C=new t.Composer.MediaDataBoxComposer({data:n(P)}).compose(),X=new t.Composer.SampleTableBoxComposer([d,B,y,O,m]).compose(),x=new t.Composer.MediaInformationBoxComposer([l,E,X]).compose(),S=new t.Composer.MediaBoxComposer([c,f,x]).compose(),D=new t.Composer.TrackBoxComposer([h,S]).compose(),U=new t.Composer.MovieBoxComposer([u,D]).compose();return n([p.bytes,U,C])};var s=function(r,i){var n=new t.Finder(i),s=n.findOne(t.BOX_TYPE_MP4_AUDIO_SAMPLE_ENTRY),a=n.findOne(t.BOX_TYPE_SAMPLE_TO_CHUNK_BOX),o=n.findOne(t.BOX_TYPE_SAMPLE_SIZE_BOX),p=n.findOne(t.BOX_TYPE_CHUNK_OFFSET_BOX),u=new Uint8Array(7*o.sampleSizes.length+o.sampleSizes.reduce(function(t,e){return t+e})),_=0,h=new Uint8Array(7);h[0]=255,h[1]=249,h[2]=64|e.indexOf(s.sampleRate)<<2|s.channelCount>>2,h[6]=252;var c,f,l,E,d,B,y,O,T;for(c=0,E=0,d=a.entryCount;d>c;++c)for(f=a.entries[c].firstChunk-1,B=d>c+1?a.entries[c+1].firstChunk-1:p.chunkOffsets.length;B>f;++f)for(O=p.chunkOffsets[f],l=0,y=a.entries[c].samplesPerChunk;y>l;++l,++E)T=o.sampleSizes[E]+7,h[3]=s.channelCount<<6|T>>11,h[4]=T>>3,h[5]=31|T<<5,u.set(h,_),_+=7,u.set(r.subarray(O,O+=o.sampleSizes[E]),_),_+=o.sampleSizes[E];return u},a=function(t,e){return n(r(t,e))};t.extractRawAudio=function(e){var r=t.parse(e),n=i(r),o=new t.Finder(n),p=o.findOne(t.BOX_TYPE_MP4_AUDIO_SAMPLE_ENTRY),u=t.Parser.DecoderConfigDescriptorParser.OBJECT_TYPE_INDICATION;switch(p.esBox.esDescr.decConfigDescr.objectTypeIndication){case u.AAC:return{type:"aac",data:s(e,n)};case u.MP3:return{type:"mp3",data:a(e,n)};default:throw new TypeError("not supported object type indication.")}},t.aacToM4a=function(r){var i=new t.BitReader(r),s=48;i.skipBits(12);var a={id:i.readBits(1),layer:i.readBits(2),protectionAbsent:i.readBits(1),profile:i.readBits(2),sampleingFrequencyIndex:i.readBits(4),privateBit:i.readBits(1),channelConfiguration:i.readBits(3),original:i.readBits(1),home:i.readBits(1),copyrightIndentificationBit:i.readBits(1),copyrightIndentificationStart:i.readBits(1),aacFrameLength:i.readBits(13),atdsBufferFullness:i.readBits(11),noRawDataBlocksInFrames:i.readBits(2)};i.bitOffset=0;for(var o,p=[],u=0;!i.eof();)i.skipBits(30),o=i.readBits(13),i.skipBits(13),p.push(i.readBytes(o-7)),u=Math.max(u,o-7);var _=new t.Composer.FileTypeBoxComposer({majorBrand:"M4A ",minorVersion:1,compatibleBrands:["isom","M4A ","mp42"]}).compose();s+=_.length;
var h=Date.now(),c=600,f=e[a.sampleingFrequencyIndex],l=0|1024*p.length*c/f,E=[65536,0,0,0,65536,0,0,0,1073741824],d=new t.Composer.MovieHeaderBoxComposer({creationTime:h,modificationTime:h,timescale:c,duration:l,rate:1,volume:1,matrix:E,nextTrackID:2}).compose();s+=d.length;var B=new t.Composer.TrackHeaderBoxComposer({flags:1,creationTime:h,modificationTime:h,trackID:1,duration:l,layer:0,alternateGroup:0,volume:1,matrix:E,width:0,height:0}).compose();s+=B.length;var y=new t.Composer.MediaHeaderBoxComposer({creationTime:h,modificationTime:h,timescale:c,duration:l,language:"und"}).compose();s+=y.length;var O=new t.Composer.HandlerBoxComposer({handlerType:"soun",name:"mp4.js sound media handler"}).compose();s+=O.length;var T=new t.Composer.SoundMediaHeaderBoxComposer({balance:0}).compose();s+=T.length;var m=new t.Composer.DataEntryUrlBoxComposer({flags:1,location:""}).compose(),P=new t.Composer.DataReferenceBoxComposer({entryCount:1,entries:[m]}).compose(),v=new t.Composer.DataInformationBoxComposer([P]).compose();s+=v.length;var g=t.Parser.DecoderConfigDescriptorParser.OBJECT_TYPE_INDICATION,I={objectTypeIndication:g.AAC,streamType:5,upStream:0,bufferSizeDB:u,maxBitrate:0,avgBitrate:0,decSpecificInfo:{data:new Uint8Array([18,16])}},C={preDefined:2},X={esID:0,streamDependenceFlag:0,urlFlag:0,ocrStreamFlag:0,streamPriority:0,decConfigDescr:I,slConfigDescr:C},x={esDescr:X},S={type:t.BOX_TYPE_MP4_AUDIO_SAMPLE_ENTRY,dataReferenceIndex:1,channelCount:a.channelConfiguration,sampleSize:16,sampleRate:f,esBox:x};new t.Composer.MP4AudioSampleEntryComposer({type:t.BOX_TYPE_MP4_AUDIO_SAMPLE_ENTRY,dataReferenceIndex:1,channelCount:a.channelConfiguration,sampleSize:16,sampleRate:f,esBox:x}).compose();var D=new t.Composer.SampleDescriptionBoxComposer({entryCount:1,boxes:[S]}).compose();s+=D.length;var U=new t.Composer.TimeToSampleBoxComposer({entryCount:1,entries:[{sampleCount:p.length,sampleDelta:1024}]}).compose();s+=U.length;var Y=new t.Composer.SampleSizeBoxComposer({sampleSize:0,sampleCount:p.length,sampleSizes:p.map(function(t){return t.byteLength})}).compose();s+=Y.length;var A=p.length%16,w=A?2:1,R=[{firstChunk:1,samplesPerChunk:16,sampleDescriptionIndex:1}];2===w&&R.push({firstChunk:Math.floor(p.length/16)+1,samplesPerChunk:A,sampleDescriptionIndex:1});var b=new t.Composer.SampleToChunkBoxComposer({entryCount:w,entries:R}).compose();s+=b.length;var M=Math.ceil(p.length/16);s+=4+4*M+12;for(var N=s,F=[],L=0,k=p.length;k>L;++L)0===L%16&&F.push(N),N+=p[L].byteLength;var H=new t.Composer.ChunkOffsetBoxComposer({entryCount:M,chunkOffsets:F}).compose(),G=new t.Composer.SampleTableBoxComposer([D,U,Y,b,H]).compose(),V=new t.Composer.MediaInformationBoxComposer([T,v,G]).compose(),z=new t.Composer.MediaBoxComposer([y,O,V]).compose(),K=new t.Composer.TrackBoxComposer([B,z]).compose(),j=new t.Composer.MovieBoxComposer([d,K]).compose(),q=new t.Composer.MediaDataBoxComposer({data:n(p)}).compose();return n([_,j,q])}})(Mp4||(Mp4={}));